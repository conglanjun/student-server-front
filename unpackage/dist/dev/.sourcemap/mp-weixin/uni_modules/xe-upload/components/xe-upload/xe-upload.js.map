{"version":3,"sources":["webpack:////Users/conglanjun/project/student-server-front/uni_modules/xe-upload/components/xe-upload/xe-upload.vue?32f6","webpack:////Users/conglanjun/project/student-server-front/uni_modules/xe-upload/components/xe-upload/xe-upload.vue?14c4","webpack:////Users/conglanjun/project/student-server-front/uni_modules/xe-upload/components/xe-upload/xe-upload.vue?2220","webpack:////Users/conglanjun/project/student-server-front/uni_modules/xe-upload/components/xe-upload/xe-upload.vue?5e93","uni-app:///uni_modules/xe-upload/components/xe-upload/xe-upload.vue","webpack:////Users/conglanjun/project/student-server-front/uni_modules/xe-upload/components/xe-upload/xe-upload.vue?6315","webpack:////Users/conglanjun/project/student-server-front/uni_modules/xe-upload/components/xe-upload/xe-upload.vue?64aa"],"names":["name","props","options","default","type","data","id","renderInput","computed","mergeOptions","mergeProps","upload","methods","config","tmpResult","err","res","tmpFiles","tmpErr","initInput","accept","handleUpload","files","tmpUploads","filePath","e","handleError","handleEmits"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAsS;AACtS;AAC6D;AACL;AACqC;;;AAG7F;AACmN;AACnN,gBAAgB,iNAAU;AAC1B,EAAE,+EAAM;AACR,EAAE,oQAAM;AACR,EAAE,6QAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,wQAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAs1B,CAAgB,uyBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;ACU12B;AAMA;AAKA;AAAA;AAAA,gBAEA;EACAA;EACAC;IACAC;MACAC;QAAA;MAAA;MACAC;IACA;EACA;EACAC;IACA;MACAC;MAAA;MACAC;IACA;EACA;;EACAC;IACAC;MAAA;QAAAP;MACA;QACAF;MACA;MACA;IACA;IACAU;MAAA;QAAAH;QAAAE;MACA;QACAH;QACAC;QACAI;MACA;IACA;EACA;EACAC;IACA;IACAD;MAAA;QAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAAE;gBACAC;gBAAA,KACA;kBAAA;kBAAA;gBAAA;gBAAA;gBAAA,OACA;cAAA;gBAAA;gBAAA;gBAAAC;gBAAAC;gBAAA,KACAD;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBACAD;cAAA;gBAAA,KAGA;kBAAA;kBAAA;gBAAA;gBACAG;gBACAC;gBAAA;gBAAA,OAKA;cAAA;gBAAA;gBAAA;gBAAAA;gBAAAD;gBAAA,KAMAC;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBACAJ;cAAA;gBAEA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IACA;IACAK;MACA;MACA;MACA;QACAC;MACA;MACA;IACA;IACA;IACAC;MAAA;QAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAAC;gBAAA,MACAA;kBAAA;gBAAA;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBACAb;gBAAA,IACAA;kBAAA;kBAAA;gBAAA;gBAAA,kCACA;kBACAL;kBACAC;gBACA;cAAA;gBAEAkB;kBAAA,OACA,sDAEAd;oBACAe;kBAAA,IAEAC,EACA;gBAAA,EACA;gBAAA;gBAAA,OACA;cAAA;gBAAA;gBAAA;gBAAAV;gBAAAC;gBAAA,KACAD;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBACA;kBACAX;kBACAC;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IACA;IACAqB;MACA;QACAtB;QACAC;MACA;IACA;IACA;IACAsB;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA;gBAmBA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;EACA;AACA;AAAA,4B;;;;;;;;;;;;ACjJA;AAAA;AAAA;AAAA;AAAiuC,CAAgB,4nCAAG,EAAC,C;;;;;;;;;;;ACArvC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"uni_modules/xe-upload/components/xe-upload/xe-upload.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./xe-upload.vue?vue&type=template&id=7629b1ad&scoped=true&filter-modules=eyJYZVVwbG9hZCI6eyJ0eXBlIjoicmVuZGVyanMiLCJjb250ZW50IjoiIiwic3RhcnQiOjM4OTEsImF0dHJzIjp7Im1vZHVsZSI6IlhlVXBsb2FkIiwibGFuZyI6ImpzIn0sImVuZCI6NzMwOH19&\"\nvar renderjs\nimport script from \"./xe-upload.vue?vue&type=script&lang=js&\"\nexport * from \"./xe-upload.vue?vue&type=script&lang=js&\"\nimport style0 from \"./xe-upload.vue?vue&type=style&index=0&id=7629b1ad&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"7629b1ad\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"uni_modules/xe-upload/components/xe-upload/xe-upload.vue\"\nexport default component.exports","export * from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./xe-upload.vue?vue&type=template&id=7629b1ad&scoped=true&filter-modules=eyJYZVVwbG9hZCI6eyJ0eXBlIjoicmVuZGVyanMiLCJjb250ZW50IjoiIiwic3RhcnQiOjM4OTEsImF0dHJzIjp7Im1vZHVsZSI6IlhlVXBsb2FkIiwibGFuZyI6ImpzIn0sImVuZCI6NzMwOH19&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./xe-upload.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./xe-upload.vue?vue&type=script&lang=js&\"","<!-- eslint-disable -->\r\n<template>\r\n  <view>\r\n    <!-- #ifdef APP-PLUS -->\r\n    <view class=\"xe-upload\" v-html=\"renderInput\" :props=\"mergeProps\" :change:props=\"XeUpload.renderProps\"></view>\r\n    <!-- #endif -->\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  chooseMedia,\r\n  chooseFile,\r\n  chooseMessageFile,\r\n  uploadFile,\r\n} from '../../tools/apis';\r\nimport {\r\n  deepMerge,\r\n  awaitWrap,\r\n  base64ToPath,\r\n  isArray,\r\n} from '../../tools/tools';\r\n\r\nexport default {\r\n  name: 'XeUpload',\r\n  props: {\r\n    options: {\r\n      default: () => ({}),\r\n      type: Object,\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      id: 0, // APP上传框ID\r\n      renderInput: '', // APP上传框\r\n    };\r\n  },\r\n  computed: {\r\n    mergeOptions({ options = {} }) {\r\n      const tmpOptions = {\r\n        name: 'file',\r\n      };\r\n      return deepMerge(tmpOptions, options);\r\n    },\r\n    mergeProps({ id, renderInput, mergeOptions }) {\r\n      return {\r\n        id,\r\n        renderInput,\r\n        upload: mergeOptions,\r\n      };\r\n    },\r\n  },\r\n  methods: {\r\n    // 上传事件\r\n    async upload(type, config = {}) {\r\n      let tmpResult = [];\r\n      if (['image', 'video'].includes(type)) {\r\n        const [err, res] = await chooseMedia(type, config);\r\n        if (err) return this.handleError(err);\r\n        tmpResult = res?.tempFiles || [];\r\n      }\r\n      // H5 || APP-PLUS || MP-WEIXIN\r\n      if (['file'].includes(type)) {\r\n        let tmpFiles = {};\r\n        let tmpErr = null;\r\n        // #ifdef H5\r\n        [tmpErr, tmpFiles] = await chooseFile(config);\r\n        // #endif\r\n        // #ifdef MP-WEIXIN\r\n        [tmpErr, tmpFiles] = await chooseMessageFile(config);\r\n        // #endif\r\n        // #ifdef APP-PLUS\r\n        this.id = Math.floor(Math.random() * 100000000 + 1);\r\n        this.initInput(config.extension);\r\n        // #endif\r\n        if (tmpErr) return this.handleError(tmpErr);\r\n        tmpResult = tmpFiles?.tempFiles || [];\r\n      }\r\n      this.handleUpload(tmpResult);\r\n    },\r\n    // 初始化上传框\r\n    initInput(extension) {\r\n      const { id } = this;\r\n      let accept = extension;\r\n      if (isArray(extension)) {\r\n        accept = extension.join(',');\r\n      }\r\n      this.renderInput = `<input type=\"file\" id=\"xe-upload-${id}\" name=\"xe-upload\" ${accept ? 'accept=\"' + accept + '\"' : ''} />`;\r\n    },\r\n    // 文件上传（没有传入上传url时返回本地链接）\r\n    async handleUpload(files = []) {\r\n      if (files.filter((e) => Boolean(e)).length === 0) return;\r\n      const { mergeOptions } = this;\r\n      if (!mergeOptions.url) {\r\n        return this.handleEmits({\r\n          type: 'choose',\r\n          data: files,\r\n        });\r\n      }\r\n      const tmpUploads = files.map((e) =>\r\n        uploadFile(\r\n          {\r\n            ...mergeOptions,\r\n            filePath: e.tempFilePath,\r\n          },\r\n          e,\r\n        )\r\n      );\r\n      const [err, res] = await awaitWrap(Promise.all(tmpUploads));\r\n      if (err) return this.handleError(err);\r\n      this.handleEmits({\r\n        type: 'success',\r\n        data: res,\r\n      });\r\n    },\r\n    // 处理失败事件\r\n    handleError(error) {\r\n      this.handleEmits({\r\n        type: 'warning',\r\n        data: error,\r\n      });\r\n    },\r\n    // 处理响应事件\r\n    async handleEmits(e) {\r\n      // #ifdef APP-PLUS\r\n      if (e.type === 'choose') {\r\n        // 将base64转为本地链接\r\n        for (let i = 0; i < e.data.length; i += 1) {\r\n          const item = e.data[i];\r\n          if (!item.base64Url) {\r\n            continue;\r\n          }\r\n          const [parseError, parseUrl] = await awaitWrap(base64ToPath(item.base64Url, item.name));\r\n          if (!parseError) {\r\n            e.data[i].tempFilePath = parseUrl;\r\n          } else {\r\n            e.data[i].tempFilePath = item.base64Url;\r\n          }\r\n          delete e.data[i].base64Url;\r\n        }\r\n      }\r\n      // #endif\r\n      this.$emit('callback', e);\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<!-- #ifdef APP-PLUS -->\r\n<script module=\"XeUpload\" lang=\"renderjs\">\r\nimport {\r\n  appUploadFile,\r\n} from '../../tools/apis';\r\nimport {\r\n  awaitWrap,\r\n  fileToBase64,\r\n} from '../../tools/tools';\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      id: 0, // 上传框ID\r\n      uploadOptions: {}, // 上传配置\r\n    };\r\n  },\r\n  methods: {\r\n    // 处理 XeUpload 传入 renderjs 数据，以及调起上传框\r\n    renderProps(info) {\r\n      const { id, renderInput, upload } = info;\r\n      if (!renderInput) return;\r\n      this.id = id;\r\n      this.uploadOptions = upload;\r\n      this.$nextTick(() => {\r\n        const dom = document.getElementById(`xe-upload-${id}`);\r\n        dom.addEventListener('change', () => {\r\n          this.handleUpload();\r\n        });\r\n        dom?.click?.();\r\n      });\r\n    },\r\n    // 处理文件上传(没有传入url时返回本地链接)\r\n    async handleUpload() {\r\n      const {\r\n        url,\r\n        name,\r\n        header = {},\r\n        formData = {},\r\n      } = this.uploadOptions || {};\r\n      const dom = document.getElementById(`xe-upload-${this.id}`);\r\n      if (!dom.files[0]) return;\r\n      const tmpFileList = Array.from(dom.files);\r\n      const tmpUploads = [];\r\n      for (let i = 0; i < tmpFileList.length; i += 1) {\r\n        const e = tmpFileList[i];\r\n        let tmpType = 'file';\r\n        if (e.type.includes('image')) {\r\n          tmpType = 'image';\r\n        }\r\n        if (e.type.includes('video')) {\r\n          tmpType = 'video';\r\n        }\r\n        const tmpExts = {\r\n          size: e.size,\r\n          name: e.name,\r\n          type: e.type,\r\n          fileType: tmpType,\r\n          tempFilePath: '',\r\n          base64Url: '',\r\n        };\r\n        // 没有传入上传url时，直接返回本地链接\r\n        if (!url) {\r\n          const [parseError, parseUrl] = await awaitWrap(fileToBase64(dom.files[i]));\r\n          if (!parseError) {\r\n            tmpExts.base64Url = parseUrl;\r\n          }\r\n          tmpUploads.push(tmpExts);\r\n          continue;\r\n        };\r\n        const tmpData = new FormData();\r\n        tmpData.append(name, dom.files[i], e.name);\r\n        for (let key in formData) {\r\n          tmpData.append(key, formData[key]);\r\n        }\r\n        // 上传进度\r\n        const onprogress = (ev) => {\r\n          if(ev.lengthComputable) {\r\n            var result = (ev.loaded / ev.total) * 100;\r\n            this.handleRenderEmits({\r\n              type: 'onprogress',\r\n              data: {\r\n                progress: Math.floor(result),\r\n                current: i + 1,\r\n                total: tmpFileList.length,\r\n              },\r\n            });\r\n          };\r\n        }\r\n        tmpUploads.push(appUploadFile({\r\n          url,\r\n          header,\r\n          formData: tmpData\r\n        }, tmpExts, onprogress ));\r\n      }\r\n      // 没有传入上传url时，直接返回本地链接列表\r\n      if (!url) {\r\n        return this.handleRenderEmits({\r\n          type: 'choose',\r\n          data: tmpUploads,\r\n        });\r\n      }\r\n      this.handleRenderEmits({\r\n        type: 'onprogress',\r\n        data: {\r\n          progress: 0,\r\n          current: 1,\r\n          total: tmpFileList.length,\r\n        },\r\n      });\r\n      // 处理上传文件\r\n      const [err, res] = await awaitWrap(Promise.all(tmpUploads));\r\n      if (err) {\r\n        return this.handleRenderEmits({\r\n          type: 'warning',\r\n          data: err,\r\n        });\r\n      }\r\n      this.handleRenderEmits({\r\n        type: 'success',\r\n        data: res,\r\n      });\r\n    },\r\n    // 数据传输到XeUpload组件\r\n    handleRenderEmits(data) {\r\n      this.$ownerInstance.callMethod('handleEmits', data);\r\n    },\r\n  },\r\n};\r\n</script>\r\n<!-- #endif -->\r\n\r\n<style scoped>\r\n.xe-upload {\r\n  display: none;\r\n}\r\n</style>\r\n","import mod from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./xe-upload.vue?vue&type=style&index=0&id=7629b1ad&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./xe-upload.vue?vue&type=style&index=0&id=7629b1ad&scoped=true&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1713680003484\n      var cssReload = require(\"/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}